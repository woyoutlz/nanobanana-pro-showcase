<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 图片画廊 - 提示词复制</title>
    <style>
        /* 1. 基础样式与字体 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 30px 20px;
            background-color: #e9ecef; /* 柔和浅灰色背景 */
            line-height: 1.6;
            color: #343a40;
        }
        .header {
            text-align: center;
            margin-bottom: 50px;
            color: #212529;
        }

        /* 2. Masonry 瀑布流布局 (CSS Columns 实现) */
        .gallery-grid {
            column-count: 3; /* 默认三列 */
            column-gap: 20px;
            padding: 0 10px;
        }

        /* 响应式调整列数 */
        @media (max-width: 1200px) {
            .gallery-grid {
                column-count: 2; /* 中等屏幕两列 */
            }
        }
        @media (max-width: 768px) {
            .gallery-grid {
                column-count: 1; /* 小屏幕一列 */
            }
        }

        /* 3. 卡片样式 */
        .image-card {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px; /* 卡片之间的间距 */
            break-inside: avoid-column; /* 防止卡片在列中被分割 */
            padding: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }
        .image-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        /* 4. 图片容器与图片 */
        .image-container {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
        }
        .image-container img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
            border: 1px solid #f8f9fa;
        }
        .image-container img:hover {
            opacity: 0.95;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.4);
        }

        /* 5. 提示词显示优化 (无需滚动条) */
        .prompt-display {
            padding: 10px 5px 0 5px;
            font-size: 13px; /* 减小字体以容纳更多内容 */
            color: #5a6268;
            border-top: 1px dashed #ced4da;
        }
        .prompt-display pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 5px 0 0 0;
            padding: 0;
            font-size: 13px; /* 保持一致 */
            background: none;
            border: none;
        }
        .prompt-display strong {
            color: #495057;
        }
        
        /* 6. 复制提示信息 */
        .copy-info {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #007bff; /* 蓝色提示背景 */
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            z-index: 10;
        }
        .copy-info.show {
            opacity: 1;
        }

        /* 7. 提示词可点击样式 */
        .prompt-display {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .prompt-display:hover {
            background-color: #f8f9fa;
        }

        /* 8. 放大图片模态框 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
            animation: zoomIn 0.3s;
        }
        .modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            font-weight: bold;
            transition: color 0.2s;
            background: none;
            border: none;
            padding: 0;
        }
        .modal-close:hover {
            color: #ff6b6b;
        }

        /* 9. 筛选控件样式 */
        .filter-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .filter-select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ced4da;
            font-size: 16px;
            color: #495057;
            background-color: white;
            cursor: pointer;
            outline: none;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .filter-select:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>✨ Nanobanana Pro 图片画廊</h1>
        <p>点击任意图片即可复制完整的 **提示词 (Prompt)**。</p>
        
        <div class="filter-container">
            <label for="source-select">选择展示源：</label>
            <select id="source-select" class="filter-select">
                <option value="all">全部展示 (All)</option>
            </select>
        </div>
    </div>

    <div class="gallery-grid" id="gallery-grid">
    </div>

    <!-- 图片放大模态框 -->
    <div id="imageModal" class="modal" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">×</button>
            <img id="modalImage" src="" alt="放大图片">
        </div>
    </div>

    <script>
        // 配置：在此数组中添加您要加载的所有 JSON 文件名
        const DATA_SOURCES = ['1.json', '2.json','3.json','4.json']; 
        
        // 缓存已加载的数据
        let cachedData = {};

        document.addEventListener('DOMContentLoaded', () => {
            initGallery();
        });

        /**
         * 初始化画廊：加载数据并绑定事件
         */
        async function initGallery() {
            await loadGalleryData();
            
            // 初始化下拉菜单
            const select = document.getElementById('source-select');
            DATA_SOURCES.forEach(source => {
                const option = document.createElement('option');
                option.value = source;
                option.textContent = source;
                select.appendChild(option);
            });

            // 绑定筛选事件
            select.addEventListener('change', (e) => {
                renderFromSource(e.target.value);
            });

            // 默认渲染所有
            renderFromSource('all');
        }

        /**
         * 加载所有配置的 JSON 数据源
         */
        async function loadGalleryData() {
            const grid = document.getElementById('gallery-grid');
            try {
                const fetchPromises = DATA_SOURCES.map(source => 
                    fetch(source).then(response => {
                        if (!response.ok) {
                            console.warn(`无法加载文件: ${source}. Status: ${response.status}`);
                            return []; 
                        }
                        return response.json();
                    })
                );

                const allDataArrays = await Promise.all(fetchPromises);
                
                // 将数据存入缓存
                DATA_SOURCES.forEach((source, index) => {
                    cachedData[source] = allDataArrays[index];
                });

            } catch (error) {
                console.error("加载画廊数据失败:", error);
                grid.innerHTML = '<p style="text-align: center; color: red;">加载数据时发生致命错误。请检查 console。</p>';
            }
        }

        /**
         * 根据选择的源渲染数据
         * @param {string} source - 'all' 或具体的 json 文件名
         */
        function renderFromSource(source) {
            const grid = document.getElementById('gallery-grid');
            let dataToRender = [];

            if (source === 'all') {
                // 合并所有数据
                Object.values(cachedData).forEach(arr => {
                    dataToRender = dataToRender.concat(arr);
                });
            } else {
                dataToRender = cachedData[source] || [];
            }

            // 去重逻辑
            const seenPrompts = new Set();
            const uniqueGalleryData = dataToRender.filter(item => {
                if (item && item.prompt) {
                    const prompt = item.prompt.trim();
                    if (!seenPrompts.has(prompt)) {
                        seenPrompts.add(prompt);
                        return true;
                    }
                }
                return false;
            });

            if (uniqueGalleryData.length === 0) {
                 grid.innerHTML = '<p style="text-align: center; color: #6c757d;">该选择下没有可用的画廊数据。</p>';
            } else {
                renderGallery(uniqueGalleryData);
            }
        }

        /**
         * 渲染画廊网格
         * @param {Array<Object>} data - 包含 {prompt, imageurls} 的数组
         */
        function renderGallery(data) {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = ''; // 清空现有内容

            data.forEach((item, index) => {
                const card = document.createElement('div');
                card.classList.add('image-card');
                
                // 使用唯一的 ID 来确保 copy-info 元素可以被找到和控制
                const copyInfoId = `copy-info-${index}`;

                const imagesHtml = item.imageurls.map(url => `
                    <img src="${escapeHtml(url)}" 
                         alt="AI Generated Image" 
                         onclick="showModal(this)">
                `).join('');

                const cardHtml = `
                    <div class="image-container" data-prompt="${escapeHtml(item.prompt)}">
                        <div id="${copyInfoId}" class="copy-info">✅ 已复制提示词!</div>
                        ${imagesHtml}
                    </div>
                    <div class="prompt-display" onclick="copyPromptFromDisplay(this, '${copyInfoId}')">
                        <strong>Prompt:</strong>
                        <pre>${escapeHtml(item.prompt)}</pre>
                    </div>
                `;
                
                card.innerHTML = cardHtml;
                grid.appendChild(card);
            });
        }

        /**
         * 复制提示词到剪贴板并显示通知
         * @param {HTMLElement} imageElement - 被点击的图片元素
         * @param {string} copyInfoId - 对应提示信息元素的 ID
         */
        function copyPrompt(imageElement, copyInfoId) {
            // 查找最近的 .image-card，然后在其内部查找 .image-container 来获取 data-prompt
            const card = imageElement.closest('.image-card');
            const prompt = card.querySelector('.image-container').getAttribute('data-prompt');
            const copyInfoElement = document.getElementById(copyInfoId);

            navigator.clipboard.writeText(prompt)
                .then(() => {
                    // 显示复制成功的提示
                    copyInfoElement.classList.add('show');
                    // 确保在 1.5 秒后隐藏
                    setTimeout(() => {
                        copyInfoElement.classList.remove('show');
                    }, 1500);
                })
                .catch(err => {
                    console.error('复制失败:', err);
                    alert('复制提示词失败，请手动复制：\n' + prompt);
                });
        }
        
        /**
         * 从提示词显示区域复制提示词
         * @param {HTMLElement} promptElement - 被点击的提示词元素
         * @param {string} copyInfoId - 对应提示信息元素的 ID
         */
        function copyPromptFromDisplay(promptElement, copyInfoId) {
            const card = promptElement.closest('.image-card');
            const prompt = card.querySelector('.image-container').getAttribute('data-prompt');
            const copyInfoElement = document.getElementById(copyInfoId);

            navigator.clipboard.writeText(prompt)
                .then(() => {
                    copyInfoElement.classList.add('show');
                    setTimeout(() => {
                        copyInfoElement.classList.remove('show');
                    }, 1500);
                })
                .catch(err => {
                    console.error('复制失败:', err);
                    alert('复制提示词失败，请手动复制：\n' + prompt);
                });
        }

        /**
         * 显示放大的图片模态框
         * @param {HTMLElement} imgElement - 被点击的图片元素
         */
        function showModal(imgElement) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modalImg.src = imgElement.src;
            modal.classList.add('show');
        }

        /**
         * 关闭模态框
         */
        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
        }
        
        /**
         * HTML转义函数，防止XSS和属性值错误
         * @param {string} str - 待转义的字符串
         * @returns {string} 转义后的字符串
         */
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#039;');
        }
    </script>
  <script src="show.js"></script>
</body>
</html>