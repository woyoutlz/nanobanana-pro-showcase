<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å›¾ç‰‡ç”»å»Š - æç¤ºè¯å¤åˆ¶</title>
    <style>
        /* 1. åŸºç¡€æ ·å¼ä¸å­—ä½“ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 30px 20px;
            background-color: #e9ecef; /* æŸ”å’Œæµ…ç°è‰²èƒŒæ™¯ */
            line-height: 1.6;
            color: #343a40;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px 0 0 0; /* ç§»åŠ¨ç«¯æœ€å°åŒ–å†…è¾¹è· */
            }
        }
        .header {
            text-align: center;
            margin-bottom: 50px;
            color: #212529;
        }
        @media (max-width: 768px) {
            .header {
                margin-bottom: 15px;
                padding: 10px 5px 0 5px;
            }
            .header h1 {
                margin: 5px 0;
                font-size: 18px;
            }
            .header p {
                margin: 3px 0;
                font-size: 12px;
            }
        }

        /* 2. Masonry ç€‘å¸ƒæµå¸ƒå±€ (CSS Columns å®ç°) */
        .gallery-grid {
            column-count: 3; /* é»˜è®¤ä¸‰åˆ— */
            column-gap: 20px;
            padding: 0 10px;
        }

        /* å“åº”å¼è°ƒæ•´åˆ—æ•° */
        @media (max-width: 1200px) {
            .gallery-grid {
                column-count: 2; /* ä¸­ç­‰å±å¹•ä¸¤åˆ— */
            }
        }
        @media (max-width: 768px) {
            .gallery-grid {
                column-count: 2; /* ç§»åŠ¨ç«¯æ”¹ä¸ºä¸¤åˆ— */
                column-gap: 4px; /* æœ€å°åŒ–åˆ—é—´è· */
                padding: 0; /* ç§»åŠ¨ç«¯å»é™¤gallery-gridçš„padding */
            }
        }

        /* 3. å¡ç‰‡æ ·å¼ */
        .image-card {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px; /* å¡ç‰‡ä¹‹é—´çš„é—´è· */
            break-inside: avoid-column; /* é˜²æ­¢å¡ç‰‡åœ¨åˆ—ä¸­è¢«åˆ†å‰² */
            padding: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }
        .image-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        @media (max-width: 768px) {
            .image-card {
                border-radius: 4px; /* ç§»åŠ¨ç«¯å‡å°åœ†è§’ */
                border: none; /* ç§»åŠ¨ç«¯å»é™¤è¾¹æ¡† */
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* å‡å°é˜´å½± */
                margin-bottom: 2px; /* æœ€å°åŒ–å¡ç‰‡é—´è· */
                padding: 2px; /* æœ€å°åŒ–å¡ç‰‡å†…è¾¹è· */
            }
            .image-card:hover {
                transform: none; /* ç§»åŠ¨ç«¯å–æ¶ˆæ‚¬åœæ•ˆæœ */
            }
        }

        /* 4. å›¾ç‰‡å®¹å™¨ä¸å›¾ç‰‡ */
        .image-container {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
        }
        .image-container img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
            border: 1px solid #f8f9fa;
        }
        .image-container img:hover {
            opacity: 0.95;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.4);
        }
        @media (max-width: 768px) {
            .image-container {
                gap: 0;
                margin-bottom: 0;
            }
            .image-container img {
                border-radius: 0;
                border: none;
            }
            .image-container img:hover {
                box-shadow: none;
            }
        }

        /* 5. æç¤ºè¯æ˜¾ç¤ºä¼˜åŒ– (æ— éœ€æ»šåŠ¨æ¡) */
        .prompt-display {
            position: relative; /* ä¸ºç»å¯¹å®šä½çš„æç¤ºä¿¡æ¯æä¾›å‚è€ƒ */
            padding: 10px 5px 0 5px;
            font-size: 13px; /* å‡å°å­—ä½“ä»¥å®¹çº³æ›´å¤šå†…å®¹ */
            color: #5a6268;
            border-top: 1px dashed #ced4da;
        }
        .prompt-display pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 5px 0 0 0;
            padding: 0;
            font-size: 13px; /* ä¿æŒä¸€è‡´ */
            background: none;
            border: none;
        }
        @media (max-width: 768px) {
            .prompt-display {
                font-size: 12px;
                padding: 8px;
                background-color: #f8f9fa;
                border-radius: 4px;
                margin-top: 4px;
            }
            .prompt-display pre {
                font-size: 11px;
                margin: 2px 0 0 0;
                max-height: 100px;
                overflow-y: auto;
            }
        }
        .prompt-display strong {
            color: #495057;
        }
        
        /* 6. å¤åˆ¶æç¤ºä¿¡æ¯ - å…¨å±€é¡¶éƒ¨æ‚¬æµ® */
        .copy-info {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8); /* æ·±è‰²èƒŒæ™¯ */
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 15px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .copy-info.show {
            opacity: 1;
            transform: translateX(-50%) translateY(10px);
        }

        /* 7. æç¤ºè¯å¯ç‚¹å‡»æ ·å¼ */
        .prompt-display {
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        .prompt-display:hover {
            background-color: #f8f9fa;
        }
        .prompt-display::after {
            content: 'ç‚¹å‡»å¤åˆ¶';
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        .prompt-display:hover::after {
            opacity: 1;
        }
        @media (max-width: 768px) {
            .prompt-display::after {
                content: 'ğŸ“‹ ç‚¹å‡»å¤åˆ¶';
                font-size: 10px;
                opacity: 0.7;
                position: static;
                display: inline-block;
                margin-left: 5px;
            }
        }

        /* 8. æ”¾å¤§å›¾ç‰‡æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
            animation: zoomIn 0.3s;
        }
        .modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            font-weight: bold;
            transition: color 0.2s;
            background: none;
            border: none;
            padding: 0;
        }
        .modal-close:hover {
            color: #ff6b6b;
        }

        /* 9. ç­›é€‰æ§ä»¶æ ·å¼ */
        .filter-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .filter-select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ced4da;
            font-size: 16px;
            color: #495057;
            background-color: white;
            cursor: pointer;
            outline: none;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .filter-select:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- å…¨å±€å¤åˆ¶æç¤º Toast -->
    <div id="global-toast" class="copy-info">âœ… å·²å¤åˆ¶æç¤ºè¯!</div>

    <div class="header">
        <h1>âœ¨ Nanobanana Pro å›¾ç‰‡ç”»å»Š</h1>
        <p>ç‚¹å‡»ä»»æ„å›¾ç‰‡å³å¯å¤åˆ¶å®Œæ•´çš„ **æç¤ºè¯ (Prompt)**ã€‚</p>
        
        <div class="filter-container">
            <label for="source-select">é€‰æ‹©å±•ç¤ºæºï¼š</label>
            <select id="source-select" class="filter-select">
                <option value="all">å…¨éƒ¨å±•ç¤º (All)</option>
            </select>
        </div>
    </div>

    <div class="gallery-grid" id="gallery-grid">
    </div>

    <!-- å›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡† -->
    <div id="imageModal" class="modal" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">Ã—</button>
            <img id="modalImage" src="" alt="æ”¾å¤§å›¾ç‰‡">
        </div>
    </div>

    <script>
        // é…ç½®ï¼šåœ¨æ­¤æ•°ç»„ä¸­æ·»åŠ æ‚¨è¦åŠ è½½çš„æ‰€æœ‰ JSON æ–‡ä»¶å
        const DATA_SOURCES = ['1.json', '2.json','3.json','4.json']; 
        
        // ç¼“å­˜å·²åŠ è½½çš„æ•°æ®
        let cachedData = {};

        document.addEventListener('DOMContentLoaded', () => {
            initGallery();
        });

        /**
         * åˆå§‹åŒ–ç”»å»Šï¼šåŠ è½½æ•°æ®å¹¶ç»‘å®šäº‹ä»¶
         */
        async function initGallery() {
            await loadGalleryData();
            
            // åˆå§‹åŒ–ä¸‹æ‹‰èœå•
            const select = document.getElementById('source-select');
            DATA_SOURCES.forEach(source => {
                const option = document.createElement('option');
                option.value = source;
                option.textContent = source;
                select.appendChild(option);
            });

            // ç»‘å®šç­›é€‰äº‹ä»¶
            select.addEventListener('change', (e) => {
                renderFromSource(e.target.value);
            });

            // é»˜è®¤æ¸²æŸ“æ‰€æœ‰
            renderFromSource('all');
        }

        /**
         * åŠ è½½æ‰€æœ‰é…ç½®çš„ JSON æ•°æ®æº
         */
        async function loadGalleryData() {
            const grid = document.getElementById('gallery-grid');
            try {
                const fetchPromises = DATA_SOURCES.map(source => 
                    fetch(source).then(response => {
                        if (!response.ok) {
                            console.warn(`æ— æ³•åŠ è½½æ–‡ä»¶: ${source}. Status: ${response.status}`);
                            return []; 
                        }
                        return response.json();
                    })
                );

                const allDataArrays = await Promise.all(fetchPromises);
                
                // å°†æ•°æ®å­˜å…¥ç¼“å­˜
                DATA_SOURCES.forEach((source, index) => {
                    cachedData[source] = allDataArrays[index];
                });

            } catch (error) {
                console.error("åŠ è½½ç”»å»Šæ•°æ®å¤±è´¥:", error);
                grid.innerHTML = '<p style="text-align: center; color: red;">åŠ è½½æ•°æ®æ—¶å‘ç”Ÿè‡´å‘½é”™è¯¯ã€‚è¯·æ£€æŸ¥ consoleã€‚</p>';
            }
        }

        /**
         * æ ¹æ®é€‰æ‹©çš„æºæ¸²æŸ“æ•°æ®
         * @param {string} source - 'all' æˆ–å…·ä½“çš„ json æ–‡ä»¶å
         */
        function renderFromSource(source) {
            const grid = document.getElementById('gallery-grid');
            let dataToRender = [];

            if (source === 'all') {
                // åˆå¹¶æ‰€æœ‰æ•°æ®
                Object.values(cachedData).forEach(arr => {
                    dataToRender = dataToRender.concat(arr);
                });
            } else {
                dataToRender = cachedData[source] || [];
            }

            // å»é‡é€»è¾‘
            const seenPrompts = new Set();
            const uniqueGalleryData = dataToRender.filter(item => {
                if (item && item.prompt) {
                    const prompt = item.prompt.trim();
                    if (!seenPrompts.has(prompt)) {
                        seenPrompts.add(prompt);
                        return true;
                    }
                }
                return false;
            });

            if (uniqueGalleryData.length === 0) {
                 grid.innerHTML = '<p style="text-align: center; color: #6c757d;">è¯¥é€‰æ‹©ä¸‹æ²¡æœ‰å¯ç”¨çš„ç”»å»Šæ•°æ®ã€‚</p>';
            } else {
                renderGallery(uniqueGalleryData);
            }
        }

        /**
         * æ¸²æŸ“ç”»å»Šç½‘æ ¼
         * @param {Array<Object>} data - åŒ…å« {prompt, imageurls} çš„æ•°ç»„
         */
        function renderGallery(data) {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            data.forEach((item, index) => {
                const card = document.createElement('div');
                card.classList.add('image-card');
                
                // ä½¿ç”¨å”¯ä¸€çš„ ID æ¥ç¡®ä¿ copy-info å…ƒç´ å¯ä»¥è¢«æ‰¾åˆ°å’Œæ§åˆ¶
                const copyInfoId = `copy-info-${index}`;

                const imagesHtml = item.imageurls.map(url => `
                    <img src="${escapeHtml(url)}" 
                         alt="AI Generated Image" 
                         onclick="showModal(this)">
                `).join('');

                const cardHtml = `
                    <div class="image-container" data-prompt="${escapeHtml(item.prompt)}">
                        ${imagesHtml}
                    </div>
                    <div class="prompt-display" onclick="copyPromptFromDisplay(this)">
                        <strong>Prompt:</strong>
                        <pre>${escapeHtml(item.prompt)}</pre>
                    </div>
                `;
                
                card.innerHTML = cardHtml;
                grid.appendChild(card);
            });
        }

        /**
         * æ˜¾ç¤ºå…¨å±€ Toast æç¤º
         */
            function showToast (message) {
                const toast = document.getElementById('global-toast');
                if (!toast) return;

                toast.textContent = message;
                toast.classList.add('show');

                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨ï¼ˆé˜²æ­¢å¿«é€Ÿç‚¹å‡»æ—¶é—ªçƒï¼‰
                if (toast.timeoutId) clearTimeout(toast.timeoutId);
        
            toast.timeoutId = setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
        
        /**
         * ä»æç¤ºè¯æ˜¾ç¤ºåŒºåŸŸå¤åˆ¶æç¤ºè¯
         * @param {HTMLElement} promptElement - è¢«ç‚¹å‡»çš„æç¤ºè¯å…ƒç´ 
         */
            function copyPromptFromDisplay (promptElement) {
            const card = promptElement.closest('.image-card');
            const prompt = card.querySelector('.image-container').getAttribute('data-prompt');

            navigator.clipboard.writeText(prompt)
                .then(() => {
                    showToast('âœ… å·²å¤åˆ¶æç¤ºè¯!');
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    alert('å¤åˆ¶æç¤ºè¯å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š\n' + prompt);
                });
        }

        /**
         * æ˜¾ç¤ºæ”¾å¤§çš„å›¾ç‰‡æ¨¡æ€æ¡†
         * @param {HTMLElement} imgElement - è¢«ç‚¹å‡»çš„å›¾ç‰‡å…ƒç´ 
         */
        function showModal(imgElement) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modalImg.src = imgElement.src;
            modal.classList.add('show');
        }

        /**
         * å…³é—­æ¨¡æ€æ¡†
         */
        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
        }
        
        /**
         * HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢XSSå’Œå±æ€§å€¼é”™è¯¯
         * @param {string} str - å¾…è½¬ä¹‰çš„å­—ç¬¦ä¸²
         * @returns {string} è½¬ä¹‰åçš„å­—ç¬¦ä¸²
         */
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#039;');
        }
    </script>
  <script src="show.js"></script>
</body>
</html>